# KnowTax 智知税典 - 税务知识管理系统

KnowTax是一个基于Flask开发的智能税务知识管理系统，为税务专业人员和相关从业者提供全面的税务政策查询、问答管理和知识库服务。

## 🚀 主要功能

### 核心数据管理
- **税务政策库**: 集中管理税务相关政策文件，包括增值税、企业所得税等各类税务政策
- **问答库**: 维护常见税务问题及其标准答案，支持分类管理
- **专业词库**: 收录税务专业术语及其释义，便于学习和查询

### 用户角色管理
系统支持三种用户角色，每种角色具有不同的权限和功能：

#### 🔐 管理员 (Admin)
- 权限管理：管理用户权限分配
- 用户状态监控：查看和管理用户账户状态
- 系统配置管理

#### 👔 经理 (Manager) 
- 用户状态管理：监控用户活动状态
- 待审批任务：处理需要审批的内容更新
- 高频问题分析：查看用户最常查询的问题
- 政策更新管理：管理政策库的更新流程

#### 🎧 客服 (Service)
- 搜索功能：为用户提供知识库搜索服务
- 用户状态查询：查看用户基本信息和状态

### 数据可视化
- **资源总量构成图表**: 展示各类数据资源的分布情况
- **资源统计面板**: 实时显示数据总量、更新量等关键指标
- **基础库统计**: 分别统计政策库、知识库、词库的数据量
- **高频查询统计**: 显示最常被查询的内容及查询次数

## 🛠️ 技术架构

### 后端技术栈
- **Flask**: Web应用框架
- **SQLAlchemy**: 数据库ORM
- **SQLite**: 数据库存储
- **Werkzeug**: 密码加密和安全管理

### 前端技术栈
- **HTML5/CSS3**: 页面结构和样式
- **JavaScript/jQuery**: 交互功能
- **ECharts**: 数据可视化图表
- **响应式设计**: 支持多设备访问

## 📁 项目结构

```
├── app.py              # 主应用入口文件
├── create_user.py      # 用户初始化脚本
├── models/
│   └── user.py         # 用户数据模型
├── routes/
│   ├── auth.py         # 认证路由
│   ├── admin.py        # 管理员功能路由
│   ├── manager.py      # 经理功能路由  
│   ├── service.py      # 客服功能路由
│   └── data.py         # 数据管理路由
├── templates/          # HTML模板文件
│   ├── base.html       # 基础模板
│   ├── home.html       # 主页面
│   ├── login.html      # 登录页面
│   └── ...            # 其他功能页面
└── static/            # 静态资源文件
    ├── css/           # 样式文件
    ├── js/            # JavaScript文件
    └── icon/          # 图标文件
```

## 🔧 安装与运行

### 环境要求
- Python 3.7+
- Flask
- Flask-SQLAlchemy

### 安装步骤

1. **克隆项目**
   ```bash
   git clone <repository-url>
   cd tax_management_system
   ```

2. **安装依赖**
   ```bash
   pip install flask flask-sqlalchemy
   ```

3. **初始化用户**
   ```bash
   python create_user.py
   ```

4. **运行应用**
   ```bash
   python app.py
   ```

5. **访问系统**
   打开浏览器访问: `http://localhost:12345`

### 默认账户

系统预设了三个测试账户：

| 角色 | 用户名 | 密码 | 权限 |
|------|--------|------|------|
| 管理员 | admin_user | admin_pass | 完整系统管理权限 |
| 经理 | manager_user | manager_pass | 知识管理和审核权限 |
| 客服 | service_user | service_pass | 搜索和用户查询权限 |

## 💡 使用指南

1. **登录系统**: 选择对应角色的账户登录
2. **浏览仪表板**: 查看系统统计数据和资源概况
3. **管理数据**: 根据权限管理政策库、问答库、词库
4. **用户管理**: 管理员可进行用户权限分配
5. **内容审核**: 经理可处理待审批的内容更新

## 🔒 安全特性

- 基于Session的用户认证
- 密码哈希加密存储
- 角色权限控制
- SQL注入防护

## 📊 数据库

系统使用SQLite数据库，包含以下主要表：
- `users`: 用户信息表，存储用户账户和角色信息

## 🚀 新增后端系统

### 后端功能
本项目现已包含完整的后端系统，提供以下功能：

1. **税务公告生成器**: 生成标准化HTML税务公告
2. **版本管理系统**: 完整的政策版本控制和发布管理
3. **智能爬虫模块**: 模拟检查在线政策更新
4. **知识库管理**: 全功能CRUD操作和搜索
5. **问答系统**: 模拟LLM的智能问答服务
6. **可视化管理界面**: 现代化的Web管理后台
7. **系统备份管理**: 完整的数据备份、恢复和重置功能

### 双服务器架构
- **前端服务器**: Flask (端口 12345) - 用户界面和角色管理
- **后端服务器**: FastAPI (端口 8000) - 数据管理和API服务

### 🤖 智能自动生成功能（新增）
- **基于爬虫结果自动生成**: 根据爬虫检测到的政策更新自动生成知识库和问答库内容
- **多种生成模式**: 支持单独生成知识库、问答库或同时生成
- **智能内容模板**: 针对不同类型的政策更新使用相应的生成模板
- **统计和监控**: 提供详细的生成统计信息和操作日志
- **系统集成**: 与现有的知识库、问答系统和爬虫模块完全集成

### 启动方式

#### 方式一：启动前端服务器（传统界面）
```bash
python app.py
```
访问: http://localhost:12345

#### 方式二：启动后端服务器（新功能）
```bash
cd backend
pip install -r requirements.txt
python start_backend.py
```
访问: http://localhost:8000

#### 方式三：完整系统（推荐）
```bash
# 终端1：启动前端
python app.py

# 终端2：启动后端
cd backend
python start_backend.py
```

然后访问前端 http://localhost:12345，通过后端集成功能访问增强的税务管理工具。

### 集成访问点
在前端系统中，新增以下访问路径：
- `/backend/dashboard` - 后端管理界面
- `/backend/enhanced-policies` - 增强的政策管理
- `/backend/enhanced-qa` - 增强的问答系统
- `/backend/knowledge-management` - 知识库管理
- `/backend/announcement-generator` - 公告生成器
- `/backup-manager` - 系统备份管理界面

### 🤖 自动生成功能使用
在后端管理界面 (http://localhost:8000) 中：

1. **智能自动生成卡片**
   - 📚 生成知识库：基于爬虫结果自动生成知识库条目
   - 💬 生成问答库：基于爬虫结果自动生成问答对
   - 🚀 同时生成：一键生成知识库和问答库内容
   - 📊 查看统计：查看自动生成的详细统计信息

2. **API端点**
   - `POST /api/auto-generate/knowledge` - 生成知识库内容
   - `POST /api/auto-generate/qa` - 生成问答库内容  
   - `POST /api/auto-generate/both` - 同时生成知识库和问答库
   - `GET /api/auto-generate/stats` - 获取生成统计信息

3. **系统重置增强**
   - 系统重置时自动还原默认的知识库和问答库数据
   - 重置自动生成器的日志和统计信息

## 🛠️ 技术升级

### 新增技术栈
- **FastAPI**: 高性能API框架
- **Pydantic**: 数据验证
- **BeautifulSoup4**: HTML解析
- **Uvicorn**: ASGI服务器

### 数据流架构
```
前端Flask服务 ←→ 后端FastAPI服务 ←→ JSON数据存储
     ↓                    ↓                  ↓
  用户界面            业务逻辑            持久化存储
  角色管理            API服务            版本控制
  数据展示            智能处理            备份管理
```

## 🚧 开发说明

### 当前状态
- ✅ 前端系统：完整的用户界面和角色管理
- ✅ 后端系统：完整的数据管理和API服务
- ✅ 集成接口：前后端通信和数据同步
- ✅ 模拟功能：完整的演示数据和功能模拟

### 生产部署建议
1. **数据库升级**: 从JSON文件升级到PostgreSQL/MySQL
2. **安全加固**: 添加JWT认证、API限流等
3. **性能优化**: 数据库索引、缓存策略
4. **监控告警**: 系统监控和日志分析
5. **容器化部署**: Docker容器和K8s编排

## 📄 许可证

本项目仅供学习和研究使用。

---

**快速启动命令**:
- 前端: `python app.py`
- 后端: `cd backend && python start_backend.py`
- 完整系统: 同时运行上述两个命令